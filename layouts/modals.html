<!-- SHARED MODALS -->

<!-- ADD TASK MODAL -->
<div id="addModal" class="fixed inset-0 bg-black/80 hidden flex items-center justify-center z-50 backdrop-blur-sm">
    <div class="bg-surface p-8 rounded-3xl w-full max-w-md border border-border shadow-2xl">
        <h2 class="text-2xl font-bold mb-6">Add Assignment</h2>
        <div class="space-y-4">
            <div>
                <label class="text-xs font-bold text-muted uppercase ml-1">Class</label>
                <select id="m-course" class="w-full p-4 rounded-xl outline-none border border-border bg-base mt-1 focus:border-primary"></select>
            </div>
            <div>
                <label class="text-xs font-bold text-muted uppercase ml-1">Assignment / Task</label>
                <input type="text" id="m-title" placeholder="Task Name" class="w-full p-4 rounded-xl placeholder-muted bg-base mt-1 border border-border focus:border-primary">
            </div>
            <div class="grid grid-cols-2 gap-4">
                <div><label class="text-xs font-bold text-muted uppercase ml-1">Time (Min)</label><input type="number" id="m-est" placeholder="15" class="w-full p-4 rounded-xl placeholder-muted bg-base mt-1 border border-border"></div>
                <div><label class="text-xs font-bold text-muted uppercase ml-1">Due Date</label><input type="datetime-local" id="m-due" class="w-full p-4 rounded-xl bg-base mt-1 border border-border text-sm"></div>
            </div>
        </div>
        <div class="flex justify-end gap-3 mt-8">
            <button onclick="document.getElementById('addModal').classList.add('hidden')" class="px-6 py-3 text-muted font-bold hover:text-text">Cancel</button>
            <button onclick="addTask()" class="px-8 py-3 bg-primary hover:opacity-90 text-white rounded-xl font-bold shadow-lg">Add Task</button>
        </div>
    </div>
</div>

<!-- CLASS SETTINGS MODAL -->
<div id="classSettingsModal" class="fixed inset-0 bg-black/80 hidden flex items-center justify-center z-50 backdrop-blur-sm">
    <div class="bg-surface p-8 rounded-3xl w-full max-w-md border border-border shadow-2xl">
        <h2 class="text-2xl font-bold mb-2">Class Settings</h2>
        <p class="text-muted mb-6">Editing: <span id="modal-class-name" class="text-primary font-bold"></span></p>
        <div>
            <label class="text-xs font-bold text-muted uppercase">Color Preference</label>
            <div class="flex items-center gap-3 mt-1 bg-base p-3 rounded-lg border border-border">
                <input type="color" id="class-color-picker" class="w-10 h-10 rounded cursor-pointer border-none bg-transparent">
                <span class="text-xs text-muted">Updates dashboard instantly.</span>
            </div>
        </div>
        <div class="flex justify-end gap-3 mt-8">
            <button onclick="document.getElementById('classSettingsModal').classList.add('hidden')" class="px-6 py-2 text-muted font-bold">Cancel</button>
            <button onclick="saveClassSettings()" class="px-6 py-2 bg-primary text-white rounded-xl font-bold">Save Changes</button>
        </div>
    </div>
</div>

<!-- DETAIL MODAL -->
<div id="detailModal" class="fixed inset-0 bg-black/80 hidden flex items-center justify-center z-50 backdrop-blur-sm">
    <div class="bg-surface p-8 rounded-3xl w-full max-w-lg border border-border shadow-2xl relative">
        <button onclick="closeDetailModal()" class="absolute top-4 right-4 text-muted hover:text-text"><i class="fa-solid fa-xmark text-xl"></i></button>

        <input type="text" id="d-title" class="w-full bg-transparent text-2xl font-bold mb-2 outline-none border-b border-transparent focus:border-border" placeholder="Task Name">

        <div class="flex items-center gap-4 text-sm text-muted mb-6">
            <input type="datetime-local" id="d-due" class="bg-transparent border-none p-0 text-muted">
        </div>

        <div class="mb-6">
            <label class="text-xs font-bold text-muted uppercase tracking-wider mb-2 block">Notes</label>
            <textarea id="d-desc" class="w-full bg-base rounded-xl p-3 text-sm min-h-[80px] border border-border resize-none" placeholder="Notes..."></textarea>
        </div>

        <div class="mb-6">
             <div class="flex justify-between items-center mb-2">
                 <label class="text-xs font-bold text-muted uppercase tracking-wider block">Checklist</label>
                 <span id="d-checklist-progress" class="text-xs font-bold text-primary">0/0</span>
             </div>

             <!-- THE LIST -->
             <div id="d-checklist-container" class="space-y-1 mb-3 max-h-32 overflow-y-auto custom-scrollbar"></div>

             <!-- THE INPUT FIELD (Was missing) -->
             <div class="flex gap-2">
                 <input type="text" id="d-new-subtask" placeholder="Add step..." class="flex-1 bg-base rounded-lg px-3 py-2 text-sm border border-border outline-none focus:border-primary">
                 <button onclick="addSubtask()" class="bg-primary/10 hover:bg-primary/20 text-primary border border-primary/20 w-10 rounded-lg flex items-center justify-center transition-colors">
                     <i class="fa-solid fa-plus"></i>
                 </button>
             </div>
        </div>

        <div class="flex justify-between mt-8 pt-6 border-t border-border">
            <button onclick="deleteTask()" class="text-red-500 hover:text-red-400 text-sm font-bold flex items-center gap-2"><i class="fa-solid fa-trash"></i> Delete</button>
            <button onclick="saveTaskDetails()" class="bg-primary hover:opacity-90 text-white px-8 py-3 rounded-xl font-bold shadow-lg">Save Changes</button>
        </div>
    </div>
</div>

<!-- TEACHER ADD MODAL -->
<div id="teacherAddModal" class="fixed inset-0 bg-black/80 hidden flex items-center justify-center z-50 backdrop-blur-sm">
    <div class="bg-surface p-8 rounded-3xl w-full max-w-md border border-border shadow-2xl">
        <h2 class="text-2xl font-bold mb-6">Assign Work</h2>
        <div class="space-y-4">
            <input type="text" id="tm-title" placeholder="Assignment Title" class="w-full p-4 rounded-xl placeholder-muted bg-base border border-border outline-none focus:border-primary">

            <div class="grid grid-cols-2 gap-4">
                <select id="tm-type" class="w-full p-4 rounded-xl bg-base border border-border">
                        <option value="HOMEWORK">Homework</option>
                        <option value="TEST">Test/Exam</option>
                        <option value="QUIZ">Quiz</option>
                        <option value="PROJECT">Project</option>
                        <option value="LAB">Lab</option>
                        <option value="ESSAY">Essay</option>
                        <option value="PRESENTATION">Presentation</option>
                        <option value="BOOK REPORT">Book Report</option>
                        <option value="READING">Reading</option>
                        <option value="CLASSWORK">Classwork</option>
                        <option value="OTHER">Other</option>
                    </select>
                <input type="number" id="tm-est" placeholder="30 min" class="w-full p-4 rounded-xl bg-base border border-border">
            </div>

            <input type="datetime-local" id="tm-due" class="w-full p-4 rounded-xl bg-base border border-border text-sm">
        </div>
        <div class="flex justify-end gap-3 mt-8">
            <button onclick="document.getElementById('teacherAddModal').classList.add('hidden')" class="px-6 py-3 text-muted font-bold hover:text-text">Cancel</button>
            <button onclick="submitTeacherTask()" class="px-8 py-3 bg-primary hover:opacity-90 text-white rounded-xl font-bold shadow-lg">Create</button>
        </div>
    </div>
</div>
<div id="bulletinModal" class="fixed inset-0 bg-black/80 hidden flex items-center justify-center z-50 backdrop-blur-sm">
    <div class="bg-surface p-8 rounded-3xl w-full max-w-md border border-border shadow-2xl">
        <h2 class="text-2xl font-bold mb-2 flex items-center gap-2">
            <i class="fa-solid fa-thumbtack text-yellow-500"></i> Sticky Note
        </h2>
        <p class="text-muted text-sm mb-6">This message will appear at the top of the student dashboard.</p>

        <textarea id="bm-text" class="w-full bg-base p-4 rounded-xl border border-border focus:border-primary outline-none min-h-[120px] resize-none" placeholder="e.g. Remember to bring your textbooks tomorrow!"></textarea>

        <div class="flex justify-between mt-6">
            <button onclick="clearBulletinAction()" class="text-red-500 font-bold text-sm hover:underline px-2">Clear Active Note</button>
            <div class="flex gap-3">
                <button onclick="document.getElementById('bulletinModal').classList.add('hidden')" class="px-4 py-2 text-muted font-bold hover:text-text">Cancel</button>
                <button onclick="saveBulletinAction()" class="px-6 py-2 bg-primary hover:opacity-90 text-white rounded-xl font-bold shadow-lg">Post</button>
            </div>
        </div>
    </div>
</div>

<!-- TEACHER: SNOW DAY MODAL -->
<div id="snowDayModal" class="fixed inset-0 bg-black/80 hidden flex items-center justify-center z-50 backdrop-blur-sm">
    <div class="bg-surface p-8 rounded-3xl w-full max-w-md border border-border shadow-2xl">
        <h2 class="text-2xl font-bold mb-2 flex items-center gap-2">
            <i class="fa-regular fa-snowflake text-blue-500"></i> Snow Day Protocol
        </h2>
        <p class="text-muted text-sm mb-6">Shift all active assignment due dates forward.</p>

        <div class="bg-base p-4 rounded-xl border border-border mb-6">
            <label class="text-xs font-bold text-muted uppercase">Days to Shift</label>
            <div class="flex items-center gap-4 mt-2">
                <button onclick="adjustSnowDay(-1)" class="w-10 h-10 rounded-lg bg-surface border border-border hover:bg-border flex items-center justify-center"><i class="fa-solid fa-minus"></i></button>
                <input type="number" id="sd-days" value="1" class="w-20 text-center bg-transparent font-bold text-xl outline-none" readonly>
                <button onclick="adjustSnowDay(1)" class="w-10 h-10 rounded-lg bg-surface border border-border hover:bg-border flex items-center justify-center"><i class="fa-solid fa-plus"></i></button>
            </div>
        </div>

        <div class="flex justify-end gap-3">
            <button onclick="document.getElementById('snowDayModal').classList.add('hidden')" class="px-4 py-2 text-muted font-bold hover:text-text">Cancel</button>
            <button onclick="confirmSnowDayAction()" class="px-6 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-xl font-bold shadow-lg">Confirm Shift</button>
        </div>
    </div>
</div>

<div id="createUserModal" class="fixed inset-0 bg-black/80 hidden flex items-center justify-center z-50 backdrop-blur-sm">
    <div class="bg-surface p-8 rounded-3xl w-full max-w-md border border-border shadow-2xl">
        <h2 class="text-2xl font-bold mb-6">Create New User</h2>

        <div class="space-y-4">
            <div>
                <label class="text-xs font-bold text-muted uppercase">Full Name</label>
                <input type="text" id="nu-name" class="w-full p-3 rounded-xl bg-base border border-border mt-1 outline-none focus:border-primary">
            </div>

            <div>
                <label class="text-xs font-bold text-muted uppercase">Email</label>
                <input type="email" id="nu-email" class="w-full p-3 rounded-xl bg-base border border-border mt-1 outline-none focus:border-primary">
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="text-xs font-bold text-muted uppercase">Password</label>
                    <input type="text" id="nu-pass" value="123456" class="w-full p-3 rounded-xl bg-base border border-border mt-1 outline-none focus:border-primary">
                </div>
                <div>
                    <label class="text-xs font-bold text-muted uppercase">Role</label>
                    <select id="nu-role" class="w-full p-3 rounded-xl bg-base border border-border mt-1 outline-none focus:border-primary">
                        <option value="student">Student</option>
                        <option value="teacher">Teacher</option>
                        <option value="admin">Admin</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="flex justify-end gap-3 mt-8">
            <button onclick="closeCreateUserModal()" class="px-4 py-2 text-muted font-bold hover:text-text">Cancel</button>
            <button onclick="saveNewUser()" class="px-6 py-2 bg-primary text-white rounded-xl font-bold shadow-lg">Create User</button>
        </div>
    </div>
</div>
<!-- STUDENT: DAY DETAIL MODAL -->
<div id="dayDetailModal" class="fixed inset-0 bg-black/80 hidden flex items-center justify-center z-50 backdrop-blur-sm">
    <div class="bg-surface p-8 rounded-3xl w-full max-w-lg border border-border shadow-2xl flex flex-col max-h-[85vh]">
        <div class="flex justify-between items-center mb-6">
            <div>
                <h2 class="text-2xl font-bold" id="dd-date-title">Date</h2>
                <p class="text-muted text-sm">Daily Agenda & Topics</p>
            </div>
            <button onclick="document.getElementById('dayDetailModal').classList.add('hidden')" class="w-8 h-8 rounded-full bg-base flex items-center justify-center hover:bg-border transition-colors">
                <i class="fa-solid fa-xmark"></i>
            </button>
        </div>

        <div id="dd-content" class="flex-1 overflow-y-auto space-y-4 custom-scrollbar">
            <!-- Content injected via JS -->
        </div>
    </div>
</div>
<!-- MISSION DEBRIEF MODAL -->
<div id="completionModal" class="fixed inset-0 bg-black/90 hidden flex items-center justify-center z-50 backdrop-blur-md">
    <div class="bg-surface p-8 rounded-3xl w-full max-w-sm border border-primary/50 shadow-[0_0_50px_rgba(var(--primary),0.3)] text-center relative overflow-hidden">

        <!-- Decor -->
        <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-primary to-transparent"></div>

        <h2 class="text-2xl font-black italic uppercase tracking-wider mb-2 text-primary">Mission Debrief</h2>
        <p class="text-muted text-xs mb-6">Reflect to retain. How did it go?</p>

        <!-- Difficulty Rating -->
        <div class="mb-6">
            <label class="text-[10px] font-bold text-muted uppercase tracking-widest block mb-2">Difficulty Rating</label>
            <div class="flex justify-center gap-2">
                <button onclick="setDifficulty(1)" class="diff-btn w-10 h-10 rounded-lg border border-border hover:bg-green-500 hover:text-white transition-all font-bold text-muted" data-val="1">1</button>
                <button onclick="setDifficulty(2)" class="diff-btn w-10 h-10 rounded-lg border border-border hover:bg-yellow-500 hover:text-white transition-all font-bold text-muted" data-val="2">2</button>
                <button onclick="setDifficulty(3)" class="diff-btn w-10 h-10 rounded-lg border border-border hover:bg-orange-500 hover:text-white transition-all font-bold text-muted" data-val="3">3</button>
                <button onclick="setDifficulty(4)" class="diff-btn w-10 h-10 rounded-lg border border-border hover:bg-red-500 hover:text-white transition-all font-bold text-muted" data-val="4">4</button>
                <button onclick="setDifficulty(5)" class="diff-btn w-10 h-10 rounded-lg border border-border hover:bg-purple-600 hover:text-white transition-all font-bold text-muted" data-val="5">5</button>
            </div>
            <input type="hidden" id="cm-difficulty" value="0">
        </div>

        <!-- Time Reflection -->
        <div class="mb-8">
            <label class="text-[10px] font-bold text-muted uppercase tracking-widest block mb-2">Actual Time Spent</label>
            <div class="flex items-center justify-center gap-2">
                <input type="number" id="cm-time" class="w-24 bg-base border border-border rounded-xl p-3 text-center font-mono text-lg outline-none focus:border-primary text-text" placeholder="--">
                <span class="text-sm text-muted font-bold">MINUTES</span>
            </div>
        </div>

        <div class="flex flex-col gap-3">
            <button onclick="confirmCompletion()" class="w-full py-4 bg-primary hover:opacity-90 text-white font-black uppercase tracking-widest rounded-xl shadow-lg transform active:scale-95 transition-all">
                Mark Complete
            </button>
            <button onclick="document.getElementById('completionModal').classList.add('hidden')" class="text-xs text-muted hover:text-text uppercase tracking-widest">Cancel</button>
        </div>
    </div>
</div>